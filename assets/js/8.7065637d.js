(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{321:function(a,e,t){a.exports=t.p+"assets/img/tgm-portinari-docker-page.fab6f21d.jpg"},335:function(a,e,t){"use strict";t.r(e);var s=t(1),o=Object(s.a)({},function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"portinari-quick-start-com-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#portinari-quick-start-com-docker","aria-hidden":"true"}},[a._v("#")]),a._v(" Portinari quick start com Docker")]),a._v(" "),s("h2",{attrs:{id:"motivacao"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#motivacao","aria-hidden":"true"}},[a._v("#")]),a._v(" Motivação")]),a._v(" "),s("p",[a._v("Faz tempo que venho estudando esses frameworks Javascript da moda, tipo React, Vue e Angular.")]),a._v(" "),s("p",[a._v("Agora com a liberação do THF como Portinari, resolvi dar um gás no Angular.")]),a._v(" "),s("p",[a._v("Mas, cada vez que vou iniciar uma aplicação é aquela sofrência, npm install, baixa a internet inteira e aguarda.")]),a._v(" "),s("p",[a._v("Bom, como também to estudando muito docker, achei facilmente um monte de imagens prontas, já com Node, Angular, Ionic e até com JDK do Java pra conectar com o device.")]),a._v(" "),s("p",[a._v("Mas, usar o pronto não tem graça, o legal é fazer o meu mesmo. Então, dá-lhe quebrar a cabeça pra montar essas maquininhas:")]),a._v(" "),s("h2",{attrs:{id:"testes-basicos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#testes-basicos","aria-hidden":"true"}},[a._v("#")]),a._v(" Testes basicos")]),a._v(" "),s("p",[a._v("Comecei montando uma maquina simples, só instalando o Angular-CLI, e já coloquei o Ionic também:")]),a._v(" "),s("div",{staticClass:"language-Dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('FROM node:12.8.0-alpine\n\nRUN apk add yarn && \\\n    npm install --quiet --no-progress -g @angular/cli@8.0.1 &> /dev/null && \\\n    npm install --quiet --no-progress -g ionic@4.1.2 &> /dev/null\n\n\nCMD ["/bin/sh"]\n')])])]),s("p",[a._v("O Alpine é a menor distro Linux que encontrei, e eu queria imagens bem pequenas.")]),a._v(" "),s("p",[a._v("Mas o problema é que ele é totalmente seco, e dá uma puta trabalheira se precisar instalar muita coisa nele.")]),a._v(" "),s("p",[a._v("O legal dele é pra distribuir só o App já rodando, mas pra montar uma máquina de desenvolvimento acho que não é a melhor opção.")]),a._v(" "),s("p",[a._v("Bom, dockerfile na mão, experimentei buildar a maquineta e ver se conseguia tocar a vida e deixar as coisas rodando de vez.")]),a._v(" "),s("p",[a._v("Depois de montar a máquina com Angular e conseguir instalar tudo manualmente e fazer rodar, resolvi de fazer com duas frentes:")]),a._v(" "),s("p",[a._v('1 - Uma máquina com o Portinari, todo instalado e com um projeto modelo\n2 - Uma máquina com Ionic "Portinarizado", também prontinha, já com tudo o que for necessário pra sair buildando app.')]),a._v(" "),s("p",[a._v('Pra ambas eu pretendo fazer versões com o Tema do THF aplicado, e algumas aplicações inicializadas, tipo login, um "Crudizinho", configuração de i18n. E outras coisinhas que a gente vai se batendo pra configurar num projeto THF do Zero.')]),a._v(" "),s("h2",{attrs:{id:"hora-de-iniciar-a-maquina-do-portinari-com-base-na-de-angular-puro"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hora-de-iniciar-a-maquina-do-portinari-com-base-na-de-angular-puro","aria-hidden":"true"}},[a._v("#")]),a._v(" Hora de iniciar a máquina do Portinari com base na de Angular Puro")]),a._v(" "),s("div",{staticClass:"language-Dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('FROM tgmti/angular:0.0.1\n\nLABEL maintainer="Thiago Mota <tgmspawn@gmail.com>"\nLABEL version="0.0.1"\nLABEL title="Portinari Start Container"\nLABEL description="A started Portinari project"\nLABEL "https://portinari.io"="Portinari UI"\n\nWORKDIR /app\n\nRUN ng new my-po-project --skipInstall --skip-git\n\nWORKDIR /app/my-po-project\n\nRUN npm install\n\nRUN ng add @portinari/portinari-ui\n\nRUN npm install @portinari/portinari-templates\n\nRUN sed -i \'s/ng serve/ng serve --host 0.0.0.0/g\' package.json\n\nEXPOSE 4200\n\nCMD ["npm","start"]\n')])])]),s("p",[a._v("Nesse caso já ajustei o script "),s("code",[a._v("ng serve")]),a._v(" pra servir 0.0.0.0, senão ele não aceita conexões do Host Windows (aí vai servir pra quê afimal?)")]),a._v(" "),s("p",[a._v("Funcionou que foi uma beleza, aparece a página, aplicação já inicializada, achei massa! Só que...")]),a._v(" "),s("p",[a._v("Se eu faço mapeamento do volume, lá se vai a pasta:\n"),s("code",[a._v('docker run --rm -v "${PWD}:/app -p 4200:4200 tgmti/ionic:0.0.1-buster')])]),a._v(" "),s("p",[a._v("Claro né animal, se montar uma pasta do Host dentro do Container, o que estava lá vai ser apagado (técnicamente fica no layer da imagem e nem chega a subir pro FS do container, mas na hora de usar é o mesmo que deletado).")]),a._v(" "),s("h2",{attrs:{id:"como-diabos-fazer-pra-mapear-uma-pasta-do-windows-e-replicar-os-dados-do-linux-pra-dentro-do-windows"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#como-diabos-fazer-pra-mapear-uma-pasta-do-windows-e-replicar-os-dados-do-linux-pra-dentro-do-windows","aria-hidden":"true"}},[a._v("#")]),a._v(" Como diabos fazer pra mapear uma pasta do Windows e replicar os dados do Linux pra dentro do Windows?")]),a._v(" "),s("p",[a._v("Puta merda, aí eu sofri heim. Tentei só copiar, ou mover a pasta, mas sempre demorava uma eternidade pra processar a node_modules. E é examente por causa dessa bagaça que eu quero usar container.")]),a._v(" "),s("p",[a._v("Se monto uma pasta do Host dentro do container, no fim das contas replicar aquela pasta aqui é copiar arquivos entre filesystems diferentes.")]),a._v(" "),s("p",[a._v("Tentei compactar a node_modules e descompactar na hora de iniciar o container, consegui várias formas de mapear o container pra fazer a replicação automática.")]),a._v(" "),s("p",[a._v("Sempre que eu testava só com os arquivos da src, era uma beleza, mas colocando a node_modules o bicho sentava, e demorava as vezes mais que o npm install normal (pelo menos na minha percepção).")]),a._v(" "),s("p",[a._v("Comecei a pensar em outras formas, se eu deixar a máquina rodando só dentro do Linu, e abrir o VsCode lá dentro.")]),a._v(" "),s("h2",{attrs:{id:"vscode-docker-um-milhao-de-opcoes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vscode-docker-um-milhao-de-opcoes","aria-hidden":"true"}},[a._v("#")]),a._v(" VsCode + Docker = Um milhão de opções")]),a._v(" "),s("p",[a._v("A opção mais na cara do gol é instalar o VsCode na própria maquineta, ou em uma outra, e criar um volume compartilhado pras duas.")]),a._v(" "),s("h3",{attrs:{id:"vscode-no-linux-compartilhando-o-volume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vscode-no-linux-compartilhando-o-volume","aria-hidden":"true"}},[a._v("#")]),a._v(" VsCode no Linux compartilhando o Volume")]),a._v(" "),s("p",[a._v("Pro VsCode eu não quis perder muito tempo, fui direto atrás de quem manja, e achei uma mina Belga que só tem imagem top "),s("a",{attrs:{href:"https://github.com/meyskens/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Maartje Eyskens"),s("OutboundLink")],1),a._v(", dei pull na imagem "),s("a",{attrs:{href:"https://hub.docker.com/r/meyskens/vscode/dockerfile",target:"_blank",rel:"noopener noreferrer"}},[a._v("meyskens/vscode"),s("OutboundLink")],1),a._v(", abri um xServer e apontei o DISPLAY do Linux pra ele. Foi na hora.")]),a._v(" "),s("p",[a._v("Coisa lindja de tudo, funciona bem rápido, dá pra instalar as extensões.")]),a._v(" "),s("p",[a._v("Bem funcional, mas essa não é nada, eu paguei pau quando vi essa outra máquina aqui "),s("a",{attrs:{href:"https://github.com/meyskens/docker-vscode-maartje/blob/master/Dockerfile",target:"_blank",rel:"noopener noreferrer"}},[a._v("meyskens/vscode-maartje"),s("OutboundLink")],1),a._v('. Caramba meu, um ambiente completasso!!! Tem até Docker dentro do Docker, e eu fiquei tipo "WTF???". Ainda bem que ela comentou:')]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#Install Docker, what??? Why are you looking that way at me?")]),a._v("\n    RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" https://get.docker.com "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n    RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" -y "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-compose\n")])])]),s("p",[a._v("Hahaha, depois de perder um tempão admirando estas configurações, e mais umas outras que foram aparecendo, voltei pra minha saga.\nMontei um docker-compose.yml pra subir as duas maquinetas juntas")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3.7"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("portinari")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" tgmti/portinari\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 4200"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4200")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" portinari_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/app\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("vscode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" meyskens/vscode\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environments")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" DISPLAY=10.0.0.11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" portinari_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/app\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("portinari_app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\n")])])]),s("p",[s("code",[a._v("docker-compose up -d")]),a._v(' e "seje feliz"! Sem grilos, sem problemas, sem as minhas extensões e configurações.')]),a._v(" "),s("p",[a._v("Ai ai, eu ia ter que ficar horas trabalhando em cima pra montar uma máquina do meu jeito, igual a da menina Belga. E outra, eu quero usar o VsCode no Windows, não porque é melhor, só porque eu não consegui fazer ainda.")]),a._v(" "),s("p",[a._v("Então, já que desse jeito eu sei que funciona, parti pra ver os outros links que apareceram na pesquisa "),s("code",[a._v("docker vscode")]),a._v(".")]),a._v(" "),s("h3",{attrs:{id:"vscode-server-dentro-do-container"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vscode-server-dentro-do-container","aria-hidden":"true"}},[a._v("#")]),a._v(" VsCode Server dentro do Container")]),a._v(" "),s("p",[a._v("A Microsoft lançou um pacote de extensões sensacional pra trabalhar com Docker.\nA extensão Docker eu já uso a um tempo, apesar de que eu costumo mesmo é rodar um docker exec, ao invés de clicar com o direito em attach terminal.")]),a._v(" "),s("p",[a._v("Só que o pacote "),s("a",{attrs:{href:"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack",target:"_blank",rel:"noopener noreferrer"}},[a._v("Remote Development"),s("OutboundLink")],1),a._v(" é coisa de maluco:")]),a._v(" "),s("ul",[s("li",[a._v("Remote SSH")]),a._v(" "),s("li",[a._v("Remote Containers")]),a._v(" "),s("li",[a._v("Remote WSL")])]),a._v(" "),s("p",[a._v("Caramba, fui direto nessa terceira, rodei um docker run dentro do wsl, criando uma pasta na home e mapeando pro volume, mas deu pau nas permissões. Putz, deixei pra lá (depois tenho que tentar outra vez).")]),a._v(" "),s("p",[a._v("Remote SSH eu já sabia como ia funcionar, dei uma fuçada pra ver se tinha algum jeito de fazer sem mexer no dockerfile, humm, serve um monte, mas não pra o que eu queria agora.")]),a._v(" "),s("p",[a._v("Remote Container é show. Dá pra selecionar quais extenções serão instadas dentro do container, e ela já sai fazendo tudo sozinha, configurando as portas, instalando o VSCode Server, Instalando as extenções, monta o docker-compose, cria um Dockerfile.")]),a._v(" "),s("p",[a._v("Faz tudo sozinha. Vai ser bem útil no futuro, mas ainda demora muito, e também, se eu tivesse afim de pegar o negócio pronto, não tinha partido do zero (ah, lembrei agora foi nessa hora que eu mudei do alpine pro Debian Buster Slim na verdade, o VsCode não conseguia instalar as coisas no alpine, o vscode-insiders consegue, mas deu pau, acho até que vou tentar voltar pro alpine depois).")]),a._v(" "),s("h3",{attrs:{id:"ainda-nao-tava-do-jeito-que-eu-queria"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ainda-nao-tava-do-jeito-que-eu-queria","aria-hidden":"true"}},[a._v("#")]),a._v(" Ainda não tava do jeito que eu queria.")]),a._v(" "),s("p",[a._v("Não que as opções que achei não fossem sensacionais, é que, pra compartilhar isso, tem que ser bem fácil, e de preferência rodar no Windows Home com Dockertools da firma, por isso, voltei pra pesquisa.")]),a._v(" "),s("p",[a._v("Pensei um pouco mais no que aprendi nessas brincadeiras.")]),a._v(" "),s("ul",[s("li",[a._v("Quando eu compartilho um volume com o Windows ("),s("code",[a._v("-v c:\\temp:/app")]),a._v(") dá pra usar localmente, mas fica lento pra copiar a node_modules")]),a._v(" "),s("li",[a._v("Se eu mapear a pasta do app inteira, tenho que usar recursos bem mais complicados pra acessar a pasta através de outro container, ou com as extenções do VsCode.")]),a._v(" "),s("li",[a._v("Mas se eu criar o volume só na estrutura dos containers, fica super rápido.")])]),a._v(" "),s("h1",{attrs:{id:"e-finalmente"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#e-finalmente","aria-hidden":"true"}},[a._v("#")]),a._v(" E finalmente")]),a._v(" "),s("pre",[s("code",[a._v("E se eu mapear o /app, mas não o /app/node_modules?\n")])]),a._v(" "),s("p",[s("strong",[a._v("Google, diz aí")]),a._v(": "),s("code",[a._v("docker map volume exclude subfolder")])]),a._v(" "),s("p",[a._v("E o stackoverflow nosso de cada dia não deixou na mão: "),s("a",{attrs:{href:"https://stackoverflow.com/questions/29181032/add-a-volume-to-docker-but-exclude-a-sub-folder",target:"_blank",rel:"noopener noreferrer"}},[a._v("Add a volume to Docker, but exclude a sub-folder"),s("OutboundLink")],1)]),a._v(" "),s("pre",[s("code",[a._v("Using docker-compose I'm able to use node_modules locally, but ignore it in the docker container using the following syntax in the docker-compose.yml\n")])]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[a._v("    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'./angularApp:/opt/app'")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /opt/app/node_modules/\n")])])]),s("pre",[s("code",[a._v("So everything in ./angularApp is mapped to /opt/app and then I create another mount volume /opt/app/node_modules/ which is now empty directory - even if in my local machine ./angularApp/node_modules is not empty.\n")])]),a._v(" "),s("p",[a._v("Caramba, porque que sempre tem um jeito 300x mais simples de fazer as coisas quando a gente tentou um monte de coisa mais difícil.")]),a._v(" "),s("p",[a._v("Funcionou que é uma maravilha. Navalha de Occam, a explicação mais fácil, a menor quantidade de passos. Que coisa de loko!!!")]),a._v(" "),s("hr"),a._v(" "),s("h1",{attrs:{id:"compartilhando"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#compartilhando","aria-hidden":"true"}},[a._v("#")]),a._v(" Compartilhando:")]),a._v(" "),s("p",[a._v("Ainda vou mexer nesse repo, mas a versão de agora está taggeada como 0.0.1.")]),a._v(" "),s("p",[a._v("https://github.com/tgmti/docker-dev-utils")]),a._v(" "),s("h2",{attrs:{id:"ficou-um-pequeno-problema-ainda"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ficou-um-pequeno-problema-ainda","aria-hidden":"true"}},[a._v("#")]),a._v(" Ficou um pequeno problema ainda:")]),a._v(" "),s("p",[a._v("Quando mexo em um arquivo pelo Windows, o servidor não recompila o código automaticamente.")]),a._v(" "),s("p",[a._v('Pra resolver eu dou um "toque" nele pelo shell do container: '),s("code",[a._v("touch src/app/app.component.html")])]),a._v(" "),s("p",[a._v("Anotei essa "),s("a",{attrs:{href:"https://github.com/tgmti/docker-dev-utils/issues/1",target:"_blank",rel:"noopener noreferrer"}},[a._v("Issue"),s("OutboundLink")],1),a._v(" pra resolver outra hora.")]),a._v(" "),s("hr"),a._v(" "),s("h1",{attrs:{id:"conclusao"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#conclusao","aria-hidden":"true"}},[a._v("#")]),a._v(" Conclusão")]),a._v(" "),s("p",[a._v("Passei trabalho?")]),a._v(" "),s("ul",[s("li",[a._v("Nãaa, que isso?")])]),a._v(" "),s("p",[a._v("Valeu a pena?")]),a._v(" "),s("ul",[s("li",[a._v("Bagarai véi. Tentando fazer a bagaça funcionar do meu jeito, sem pegar muita coisa pronta, aprendi uma porrada de coisa. Sobre Node, Angular e Ionic Cli, VsCode Remote, Linux e principalmente Docker")])]),a._v(" "),s("hr"),a._v(" "),s("h1",{attrs:{id:"tl-dr"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tl-dr","aria-hidden":"true"}},[a._v("#")]),a._v(" TL;DR")]),a._v(" "),s("p",[a._v("Pra montar tudo numa máquina só, basta seguir a receitinha:")]),a._v(" "),s("p",[a._v("Dockerfile")]),a._v(" "),s("div",{staticClass:"language-Dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('FROM node:12.8.1-buster-slim\n\nLABEL maintainer="Thiago Mota <tgmspawn@gmail.com>"\nLABEL version="0.0.1"\nLABEL title="Portinari Start Container"\nLABEL description="A started Portinari project"\nLABEL "https://portinari.io"="Portinari UI"\n\n# Determina se vai iniciar o Server ao criar/iniciar o container\nENV INIT_NG_SERVER=true\n\nEXPOSE 4200\n\nRUN apt update && \\\n    apt install -y yarn\n\nRUN npm install -g @angular/cli\nRUN npm install -g npm-add-script\n\nWORKDIR /\n\nRUN ng new app --skipInstall --skip-git\n\nWORKDIR /app\nRUN npm install\nRUN ng add @portinari/portinari-ui\nRUN npm install @portinari/portinari-templates\n\nRUN sed -i \'s/ng serve/ng serve --host 0.0.0.0/g\' package.json\n\nCOPY ./start.sh /\nRUN chmod 777 /start.sh\n\n# Guardo os arquivos gerados na pasta /template, exceto os node_modules\nRUN mkdir /template/\nRUN cp -rf `ls -A | grep -v "node_modules"` /template/\n\nCOPY ./start.sh /start.sh\nCMD ["/start.sh"]\n\n')])])]),s("p",[a._v("start.sh")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/sh")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" angular.json 2"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"App exists"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Copy template to app directory..."')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" -rf /template/* /app/\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$INIT_NG_SERVER")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Starting ionic Server..."')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" start\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n")])])]),s("p",[a._v("docker-compose.yml")]),a._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3.7"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("portinari")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" tgmti/portinari"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("buster\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 4200"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4200")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/app\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" node_modules"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/app/node_modules\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("tty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" INIT_IONIC_SERVER=false\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("node_modules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n")])])]),s("p",[a._v("Executou: "),s("code",[a._v("docker-compose up")])]),a._v(" "),s("p",[a._v("E já aparece:")]),a._v(" "),s("p",[s("img",{attrs:{src:t(321),alt:"TGM Portinari Docker page"}})]),a._v(" "),s("hr")])},[],!1,null,null,null);e.default=o.exports}}]);